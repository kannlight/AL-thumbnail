# 工程3: チャットUI

## 目的
ユーザーとAIの対話をタイムライン形式で表示するチャットUIを実装する。  
この工程ではUIの見た目とインタラクションのみに集中し、API連携は工程5で行う。

## 前提条件
- 工程1（プロジェクト初期設定）が完了していること

---

## デザイン方針

- **参考:** ChatGPT / Gemini 風のシンプルなチャットUI
- **レスポンシブ:** モバイル・デスクトップ両対応
- **カラースキーム:** ダーク系を基調とする（遊戯王の世界観にマッチ）

### レイアウト構成

```
┌──────────────────────────────────────┐
│  ヘッダー (アプリ名 + メニュー)        │
├──────────────────────────────────────┤
│                                      │
│  メッセージエリア (スクロール可能)      │
│                                      │
│  ┌──────────────────────────────┐    │
│  │ ユーザーメッセージ             │    │
│  └──────────────────────────────┘    │
│                                      │
│  ┌──────────────────────────────┐    │
│  │ AIメッセージ (テキスト)        │    │
│  │ ┌────────────────────┐       │    │
│  │ │ 生成画像プレビュー    │       │    │
│  │ │  [ダウンロード]      │       │    │
│  │ └────────────────────┘       │    │
│  └──────────────────────────────┘    │
│                                      │
├──────────────────────────────────────┤
│  入力エリア (テキスト入力 + 送信)      │
└──────────────────────────────────────┘
```

---

## タスク一覧

### 3-1. 型定義の作成

**ファイル:** `src/types/index.ts`

```typescript
// 定義すべき型
export type MessageRole = "user" | "assistant";

export interface ChatMessage {
  id: string;
  role: MessageRole;
  text: string;
  images?: ChatImage[];    // AIが生成した画像（複数の場合あり）
  timestamp: number;
}

export interface ChatImage {
  id: string;
  mimeType: string;        // "image/png" など
  data: string;            // Base64エンコードされた画像データ
  // ※ 実際の画像Blobは IndexedDB に保存し、
  //   ここには参照用のIDのみ保持する設計も検討可
}

export interface ChatSession {
  id: string;
  title: string;
  messages: ChatMessage[];
  createdAt: number;
  updatedAt: number;
}
```

### 3-2. チャットメッセージコンポーネント

**ファイル:** `src/components/chat/ChatMessage.tsx`

コンポーネント要件:
- `role` に応じてスタイルを切り替える（ユーザー: 右寄せ / AI: 左寄せ）
- テキストの表示（マークダウン対応は任意）
- 画像がある場合はプレビューを表示
- 各画像にダウンロードボタンを設置
- タイムスタンプの表示（任意）

### 3-3. 画像プレビュー & ダウンロードコンポーネント

**ファイル:** `src/components/chat/ImagePreview.tsx`

コンポーネント要件:
- 生成画像のサムネイル表示
- クリックで拡大表示（モーダル or ライトボックス）
- ダウンロードボタン（ファイル名例: `al-thumbnail-YYYYMMDD-HHMMSS.png`）
- 画像の読み込み中はスケルトン or スピナー表示

### 3-4. メッセージ入力コンポーネント

**ファイル:** `src/components/chat/ChatInput.tsx`

コンポーネント要件:
- テキスト入力欄（`textarea`、自動リサイズ推奨）
- 送信ボタン
- Enter で送信、Shift+Enter で改行
- 送信中（API通信中）は入力と送信ボタンを無効化
- モバイルでの入力体験にも配慮

### 3-5. チャット画面本体

**ファイル:** `src/app/chat/page.tsx`

ページ要件:
- ヘッダー: アプリ名、新規チャット開始ボタン
- メッセージ一覧: `ChatMessage` コンポーネントのリスト表示
- 自動スクロール: 新しいメッセージが追加されたら最下部にスクロール
- ローディング: AI 応答待ち中のインジケータ表示（例: 「考え中...」のアニメーション）
- 空状態: メッセージがない場合のウェルカムメッセージ（例: 「サムネイルを作りましょう！」）

### 3-6. レスポンシブ対応

**ブレークポイント方針:**

| デバイス | 幅 | 対応 |
|---|---|---|
| モバイル | < 640px | 全幅レイアウト、入力欄下部固定 |
| タブレット | 640px - 1024px | パディング調整 |
| デスクトップ | > 1024px | 最大幅制限（例: 800px）、中央配置 |

---

## 開発時のモックデータ

API連携前にUIの動作確認を行うため、以下のモックデータを用意すること。

```typescript
const mockMessages: ChatMessage[] = [
  {
    id: "1",
    role: "user",
    text: "ブルーアイズ・ホワイト・ドラゴンをテーマにしたサムネイルを作って",
    timestamp: Date.now() - 60000,
  },
  {
    id: "2",
    role: "assistant",
    text: "ブルーアイズ・ホワイト・ドラゴンをモチーフにしたサムネイルを作成しました！",
    images: [
      {
        id: "img-1",
        mimeType: "image/png",
        data: "...", // ダミー画像データ
      },
    ],
    timestamp: Date.now(),
  },
];
```

---

## 完了条件
- [ ] チャットメッセージが正しく表示される（ユーザー/AIの区別）
- [ ] 画像プレビューとダウンロードが動作する
- [ ] テキスト入力と送信のインタラクションが動作する
- [ ] 新規メッセージ追加時に自動スクロールする
- [ ] モバイル・デスクトップそれぞれで適切に表示される
- [ ] モックデータで一連の動作がデモできる
